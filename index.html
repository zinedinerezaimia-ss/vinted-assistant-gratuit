<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assistant Vinted IA (100% Gratuit)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        body { background-color: #f8f9fa; }
        .container { max-width: 600px; }
    </style>
</head>
<body class="py-5">
    <div class="container">
        <h1 class="text-center mb-4">Assistant Vinted IA</h1>
        <p class="text-center mb-4">Prends une photo de ton article → l'IA s'occupe du reste !</p>
        <form id="uploadForm" enctype="multipart/form-data">
            <div class="mb-3">
                <input type="file" class="form-control" name="photo" accept="image/*" required>
            </div>
            <button type="submit" class="btn btn-primary w-100">Analyser</button>
        </form>
        <div class="progress mt-3" id="progress" style="display: none;">
            <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%;"></div>
        </div>
        <div id="result" class="mt-4" style="display: none;"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        const form = document.getElementById('uploadForm');
        const progress = document.getElementById('progress');
        const progressBar = progress.querySelector('.progress-bar');
        const resultDiv = document.getElementById('result');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            progress.style.display = 'block';
            progressBar.style.width = '0%';
            resultDiv.style.display = 'none';

            // Simulation de progression (adapte avec XMLHttpRequest pour vrai upload si besoin)
            let pct = 0;
            const interval = setInterval(() => {
                pct += 20;
                if (pct >= 100) pct = 100;
                progressBar.style.width = `${pct}%`;
                if (pct === 100) clearInterval(interval);
            }, 500);

            const formData = new FormData(form);
            try {
                const response = await fetch('/.netlify/functions/process', { method: 'POST', body: formData });
                const data = await response.json();
                if (data.error) throw new Error(data.error);

                progress.style.display = 'none';
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `
                    <h3 class="mb-3">Résultats (édite si besoin)</h3>
                    <form id="editForm">
                        <div class="mb-3">
                            <label for="titre" class="form-label">Titre (copier pour Vinted)</label>
                            <input type="text" class="form-control" id="titre" value="${data.titre}">
                            <button type="button" class="btn btn-secondary mt-2 copy-btn" data-target="titre">Copier</button>
                        </div>
                        <div class="mb-3">
                            <label for="description" class="form-label">Description (copier pour Vinted)</label>
                            <textarea class="form-control" id="description" rows="5">${data.description}</textarea>
                            <button type="button" class="btn btn-secondary mt-2 copy-btn" data-target="description">Copier</button>
                        </div>
                        <div class="mb-3">
                            <label for="categorie" class="form-label">Catégorie (suggérée, sélectionne pour Vinted)</label>
                            <select class="form-select" id="categorie">
                                <option value="${data.categorie}">${data.categorie}</option>
                                <option value="Vêtements femmes">Vêtements femmes</option>
                                <option value="Chaussures femmes">Chaussures femmes</option>
                                <option value="Sacs femmes">Sacs femmes</option>
                                <option value="Accessoires femmes">Accessoires femmes</option>
                                <option value="Vêtements hommes">Vêtements hommes</option>
                                <option value="Chaussures hommes">Chaussures hommes</option>
                                <!-- Ajoute plus si besoin -->
                            </select>
                            <button type="button" class="btn btn-secondary mt-2 copy-btn" data-target="categorie">Copier</button>
                        </div>
                        <div class="mb-3">
                            <label for="prix" class="form-label">Prix (copier pour Vinted)</label>
                            <input type="text" class="form-control" id="prix" value="${data.prix} €">
                            <button type="button" class="btn btn-secondary mt-2 copy-btn" data-target="prix">Copier</button>
                        </div>
                        <p class="text-muted">${data.conseil}</p>
                    </form>
                `;

                // Ajoute listeners pour copier
                document.querySelectorAll('.copy-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const target = document.getElementById(btn.dataset.target);
                        navigator.clipboard.writeText(target.value || target.innerText);
                        btn.textContent = 'Copié !';
                        setTimeout(() => btn.textContent = 'Copier', 2000);
                    });
                });
            } catch (err) {
                progress.style.display = 'none';
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `<div class="alert alert-danger">Erreur : ${err.message}</div>`;
            }
        });
    </script>
</body>
</html>
